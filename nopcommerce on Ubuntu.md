### Installations and Configurations
------------------------------------

Before installing .NET Core, we'll need to register the Microsoft key and install the required dependencies.

This needs to be done once per machine.

> Step1 - Register Microsoft key and feed
> ---------------------------------------

- Open a terminal and run the following commands:
```
wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
```

```
sudo dpkg -i packages-microsoft-prod.deb
```

> Step2 - Install the .NET Core Runtime
> -------------------------------------

- Update the products available for installation, then install the .NET runtime:
```
sudo apt-get update
```

```
sudo apt-get install -y apt-transport-https aspnetcore-runtime-6.0
```

* You can see all installed .Net Core runtimes by the following command:
```
dotnet --list-runtimes
```

> Step3 - Install mysql-shell
> ---------------------------

*MySQL Shell is an advanced client and code editor for MySQL Server.In addition to the provided SQL functionality, similar to mysql, 
MySQL Shell provides scripting capabilities for JavaScript and Python and includes APIs for working with MySQL.*

- To install mysql-shell, simply use the following commands:

```
sudo apt install mysql-client-core-8.0
```

```
sudo apt install snapd
````

```
sudo snap install mysql-shell
```

> Step4 - Install nginx
> ---------------------

- Install the nginx package:
```
sudo apt-get install nginx
```
* Run the nginx service:
```
sudo systemctl start nginx
```
- Also check the status:
```
sudo systemctl status nginx
```
- To configure nginx as a reverse proxy to forward requests to your ASP.NET Core app, modify
/etc/nginx/sites-available/default

- Open it in a text editor and replace the contents with the following:

```ini

# Default server configuration
#
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    server_name   nopCommerce-450.com;

    location / {
    proxy_pass         http://localhost:5000;
    proxy_http_version 1.1;
    proxy_set_header   Upgrade $http_upgrade;
    proxy_set_header   Connection keep-alive;
    proxy_set_header   Host $host;
    proxy_cache_bypass $http_upgrade;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
    }

    # SSL configuration
    #
    # listen 443 ssl default_server;
    # listen [::]:443 ssl default_server;
    #
    # Note: You should disable gzip for SSL traffic.
    # See: https://bugs.debian.org/773332
    #
    # Read up on ssl_ciphers to ensure a secure configuration.
    # See: https://bugs.debian.org/765782
    #
    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    # include snippets/snakeoil.conf;
}
```
> Step5 - Get nopCommerce
> -----------------------

- Create a directory:
```
mkdir /var/www/nopCommerce450
```
- Download and unpack nopCommerce:
```
cd /var/www/nopCommerce450

sudo wget https://github.com/nopSolutions/nopCommerce/releases/download/release-4.50.2/nopCommerce_4.50.2_NoSource_linux_x64.zip

sudo apt-get install unzip

sudo unzip nopCommerce_4.50.2_NoSource_linux_x64.zip
```
- Create couple directories to run nopCommerce:
```
sudo mkdir bin
```
```
sudo mkdir logs
```
- Change the file permissions:
```
cd ..
sudo chgrp -R www-data nopCommerce450/
sudo chown -R www-data nopCommerce450/
```
> Step6 - Create the nopCommerce service
> --------------------------------------

- Create the /etc/systemd/system/nopCommerce450.service file with the following contents:
```
[Unit]
Description=Example nopCommerce app running on Xubuntu

[Service]
WorkingDirectory=/var/www/nopCommerce450
ExecStart=/usr/bin/dotnet /var/www/nopCommerce450/Nop.Web.dll
Restart=always
# Restart service after 10 seconds if the dotnet service crashes:
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=nopCommerce450-example
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false

[Install]
WantedBy=multi-user.target
```
- Start the service:
```
sudo systemctl start nopCommerce450.service
```
- Check the nopCommerce service status:
```
sudo systemctl status nopCommerce450.service
```
- Restart the nginx server:
```
sudo systemctl restart nginx
```
*Now that everything is ready, we can proceed to install and configure the store.*

- The further installation process for nopCommerce is the same as the installation process on Windows.
- We can use the following 
[Installation process](https://docs.nopcommerce.com/en/installation-and-upgrading/installing-nopcommerce/installing-on-windows.html#install-nopcommerce)

> Troubleshooting
> ---------------

- Gdip

*If you have any problem with loading images in the RichText Box (The type initializer for 'Gdip' threw an exception), just install the libgdiplus library:*
```
sudo apt-get install libgdiplus
```
- SSL

*If you want to use SSL on your site, don't forget to set the ``UseHttpXForwardedProto`` setting to ``true`` in the **appsettings.json** file.*


> Xtra Stuff

- Try to run the following two commands:
```
sudo fuser -k 80/tcp
```
```
sudo fuser -k 443/tcp
```
- And then execute
```
sudo service nginx restart
```

